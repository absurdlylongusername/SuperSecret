@page
@model SuperSecret.Pages.Admin.IndexModel

<div class="min-vh-100 d-flex align-items-center justify-content-center">
  <div class="card bg-body-tertiary border-secondary shadow w-100" style="max-width:560px;">
    <div class="card-body">
      <h2 class="h4 mb-4">Generate Secret Link</h2>

      <form method="post" novalidate>
        <div asp-validation-summary="ModelOnly" class="alert alert-danger py-2 mb-3" role="alert"></div>

        <div class="mb-3">
          <label asp-for="@Model.Input.Username" class="form-label"></label>
          <input asp-for="@Model.Input.Username" type="text" class="form-control bg-dark text-light border-secondary" />
          <span asp-validation-for="@Model.Input.Username" class="text-danger small"></span>
        </div>

        <div class="mb-3">
          <label asp-for="@Model.Input.Max" class="form-label"></label>
          <input asp-for="@Model.Input.Max"
                          type="number"
                          min="1"
                          max="@Model.MaxClicks"
                          step="1"
                          class="form-control bg-dark text-light border-secondary" />
          <span asp-validation-for="@Model.Input.Max" class="text-danger small"></span>
        </div>

        <div class="mb-3">
          @* @{ var now = DateTimeOffset.Now.ToString("yyyy-MM-ddTHH:mm"); } *@
          <label asp-for="@Model.Input.ExpiresAt" class="form-label"></label>
          <input asp-for="@Model.Input.ExpiresAt" type="datetime-local" 
                          min="@DateTimeOffset.UtcNow:yyyy-MM-ddTHH:mm"
                          class="form-control bg-dark text-light border-secondary" />
          <span asp-validation-for="@Model.Input.ExpiresAt" class="text-danger small"></span>
        </div>

        <div class="d-flex justify-content-end">
          <button type="submit" class="btn btn-primary">Generate Link</button>
        </div>
      </form>

      @if (!string.IsNullOrEmpty(Model.GeneratedUrl))
      {
        <div class="mt-3" aria-live="polite">
          <div class="input-group">
            <button type="button" class="btn btn-outline-light" onclick="copyLink()">Copy</button>
            <input type="text" id="generatedUrl" class="form-control bg-dark text-light border-secondary" value="@Model.GeneratedUrl" readonly />
          </div>
          <div id="copyStatus" class="form-text text-success d-none">Link copied!</div>
        </div>
      }
    </div>
  </div>
</div>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    function copyLink() {
      const input = document.getElementById('generatedUrl');
      if (!input) return;

      input.select();
      input.setSelectionRange(0, input.value.length);
      navigator.clipboard.writeText(input.value).then(() => {
        const status = document.getElementById('copyStatus');
        if (status) {
          status.classList.remove('d-none');
          setTimeout(() => status.classList.add('d-none'), 2000);
        }
      });
    }
  </script>
}