@page
@model SuperSecret.Pages.Admin.IndexModel

<div class="min-vh-100 d-flex align-items-center justify-content-center">
  <div class="card bg-body-tertiary border-secondary shadow w-100" style="max-width:560px;">
    <div class="card-body">
      <h2 class="h4 mb-4">Generate Secret Link</h2>

      <form method="post" novalidate>
        <div asp-validation-summary="ModelOnly" class="alert alert-danger py-2 mb-3" role="alert"></div>

        <div class="mb-3">
          <label asp-for="@Model.Input.Username" class="form-label"></label>
          <input asp-for="@Model.Input.Username" type="text" class="form-control bg-dark text-light border-secondary" />
          <span asp-validation-for="@Model.Input.Username" class="text-danger small"></span>
        </div>

        <div class="mb-3">
          <label asp-for="@Model.Input.Max" class="form-label"></label>
          <input asp-for="@Model.Input.Max"
                 type="number"
                 min="1"
                 max="@Model.MaxClicks"
                 step="1"
                 class="form-control bg-dark text-light border-secondary" />
          <span asp-validation-for="@Model.Input.Max" class="text-danger small"></span>
        </div>

        <div class="form-check form-switch mb-2">
          <input asp-for="Input.HasExpiryDate" class="form-check-input" />
          <label asp-for="Input.HasExpiryDate" class="form-check-label">Set custom expiry</label>
        </div>

        <fieldset id="expiryGroup" disabled>
          <span asp-validation-for="@Model.Input.ExpiresAt" class="text-danger small"></span>
          <div class="mb-3">
            <div class="d-flex gap-2">
              <div class="flex-fill">
                <label asp-for="Input.DurationInDays"></label>
                <input asp-for="Input.DurationInDays"
                       type="number"
                       min="0"
                       max="30"
                       step="1"
                       placeholder="Days"
                       class="form-control bg-dark text-light border-secondary text-center expiry-field" />
                <span asp-validation-for="Input.DurationInDays" class="text-danger small"></span>
              </div>

              <div class="flex-fill">
                <label asp-for="Input.DurationInHours"></label>
                <input asp-for="Input.DurationInHours"
                       type="number"
                       min="0"
                       max="23"
                       step="1"
                       placeholder="Hours"
                       class="form-control bg-dark text-light border-secondary text-center expiry-field" />
                <span asp-validation-for="Input.DurationInHours" class="text-danger small"></span>
              </div>

              <div class="flex-fill">
                <label asp-for="Input.DurationInMinutes"></label>
                <input asp-for="Input.DurationInMinutes"
                       type="number"
                       min="0"
                       max="59"
                       step="1"
                       placeholder="Minutes"
                       class="form-control bg-dark text-light border-secondary text-center expiry-field" />
                <span asp-validation-for="Input.DurationInMinutes" class="text-danger small"></span>
              </div>

              <div class="flex-fill">
                <label asp-for="Input.DurationInSeconds"></label>
                <input asp-for="Input.DurationInSeconds"
                       type="number"
                       min="0"
                       max="59"
                       step="1"
                       placeholder="Seconds"
                       class="form-control bg-dark text-light border-secondary text-center expiry-field" />
                <span asp-validation-for="Input.DurationInSeconds" class="text-danger small"></span>
              </div>
            </div>
            <div class="form-text mt-1">Specify how long the link lasts. Leave unchecked to use the default expiry.</div>
          </div>
        </fieldset>

        <div class="d-flex justify-content-end">
          <button type="submit" class="btn btn-primary">Generate Link</button>
        </div>
      </form>

      @if (!string.IsNullOrEmpty(Model.GeneratedUrl))
      {
        <div class="mt-3" aria-live="polite">
          <div class="input-group">
            <button type="button" class="btn btn-outline-light" onclick="copyLink()">Copy</button>
            <input type="text" id="generatedUrl" class="form-control bg-dark text-light border-secondary" value="@Model.GeneratedUrl" readonly />
          </div>
          <div id="copyStatus" class="form-text text-success d-none">Link copied!</div>
        </div>
      }
    </div>
  </div>
</div>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    (function () {
      const toggle = document.getElementById('Input_HasExpiryDate');
      const expiryGroup = document.getElementById('expiryGroup');

      const sync = () => expiryGroup.disabled = !toggle.checked;
      sync();
      toggle.addEventListener('change', sync);
    })();

    function copyLink() {
      const input = document.getElementById('generatedUrl');
      if (!input) return;

      input.select();
      input.setSelectionRange(0, input.value.length);
      navigator.clipboard.writeText(input.value).then(() => {
        const status = document.getElementById('copyStatus');
        if (status) {
          status.classList.remove('d-none');
          setTimeout(() => status.classList.add('d-none'), 2000);
        }
      });
    }
  </script>
}